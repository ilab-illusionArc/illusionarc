import{d as je,r as s,k as I,I as wt,o as ht,e as Mt,x as v,y as c,z as t,J as k,K as y,L as fe,A as i,D as Le,M as N,N as me,O as qe,P as kt,Q as gt,_ as Je,B as xt}from"./CPrxqWd0.js";const St={class:"mTop"},_t={class:"mTags"},Pt={class:"tag"},Ct={class:"tag"},Bt={class:"mActions"},Tt=["disabled"],Lt={class:"sub"},Rt={class:"mStats"},At={class:"chip"},Dt={class:"chip"},It={class:"chip"},Nt={class:"chip"},Et={class:"titleRow"},$t={class:"badge"},zt={class:"row"},Ft=["disabled"],Ut={class:"sub"},Vt={class:"row modeRow"},Gt={class:"pill"},Ot={class:"pill"},Yt={class:"stats"},Kt={class:"stat"},Ht={class:"stat"},Wt={class:"stat"},Xt={class:"stat"},qt={class:"stat score"},Qt={key:1,class:"startHint"},jt={key:2,class:"winBox"},Jt={class:"winMeta"},Zt={class:"row"},en=["disabled"],tn={key:0,class:"rankBox"},nn={class:"mRow"},on=["disabled"],an={class:"modalHead"},ln={class:"modalSub"},sn={key:0,class:"lbLoading"},un={key:1,class:"lbList"},rn={class:"rank"},dn={class:"nameRow"},vn={class:"scoreRow"},cn={class:"small"},fn={key:0,class:"lbEmpty"},mn={class:"settingsBlock"},pn={class:"settingsRow"},yn={class:"pill"},bn={class:"pill"},S=17,_=17,wn=220,hn=700,Mn=6e3,kn=10,gn=4,xn=14,Sn=160,Qe=26,_n=260,Pn=je({__name:"BlinkMazeGame",setup(Ze){const E=s(null),w=s(null),$=s(!1),T=s(0),z=s(0),L=s(0),b=s(!1),Z=s(0),ee=s(!1),R=s(!1);let a=null,Re=0;const pe=s(!1),ye=s(!1);function Ae(){pe.value=!0,We()}function De(){pe.value=!1}function et(){ye.value=!0}function be(){ye.value=!1}let Ie=[];function tt(n,e){const o=Math.floor(Math.min(160,n*e/9e3));Ie=Array.from({length:o},()=>({x:Math.random()*n,y:Math.random()*e,r:.6+Math.random()*1.6,s:.15+Math.random()*.55,a:.25+Math.random()*.55}))}const A=s(""),we=s("info");let F=null;function g(n,e="info",o=900){A.value=n,we.value=e,F&&window.clearTimeout(F),F=window.setTimeout(()=>A.value="",o)}const d=s("daily"),U=s("Guest");function nt(){const n=new Date,e=n.getFullYear(),o=String(n.getMonth()+1).padStart(2,"0"),u=String(n.getDate()).padStart(2,"0");return`${e}-${o}-${u}`}const Ne=s(nt()),te=s(Math.floor(Math.random()*1e9)),x=I(()=>d.value==="daily"?Ne.value:String(te.value)),ne=I(()=>d.value==="daily"?"Daily":"Random");function ot(){const n=new URL(window.location.href),e=n.searchParams.get("mode"),o=n.searchParams.get("seed");(e==="random"||e==="daily")&&(d.value=e),o&&o.length<=32&&(d.value==="daily"?Ne.value=o:te.value=/^\d+$/.test(o)?Number(o):Math.floor(Math.random()*1e9))}function oe(){const n=new URL(window.location.href);n.searchParams.set("mode",d.value),n.searchParams.set("seed",x.value),window.history.replaceState({},"",n.toString())}const D=s(!1),ae=s(0),he=s(Date.now());let Me=null;const le=I(()=>!D.value||ae.value===0?0:Math.max(0,he.value-ae.value));function Ee(){b.value||D.value||(D.value=!0,ae.value=Date.now())}const B=I(()=>Math.max(0,Z.value-he.value));function $e(n,e,o,u){const l=Math.floor(Math.max(0,n)/1e3);return Math.max(0,Math.floor(Mn-l*kn-e*Sn-o*gn-u*xn))}const V=s(0),G=s(0),O=s(0),Y=s(0),K=s(0),ze=I(()=>D.value?b.value?K.value:$e(le.value,T.value,z.value,L.value):0),Fe=I(()=>R.value&&$.value);function ke(){return{n:!0,e:!0,s:!0,w:!0,visited:!1}}let Ue=Array.from({length:_},()=>Array.from({length:S},()=>ke()));function Ve(n,e){return n>=0&&e>=0&&n<S&&e<_}function P(n,e){return Ue[e]?.[n]??ke()}const H=s({x:0,y:0}),W=s({x:S-1,y:_-1});function at(n){let e=2166136261;for(let o=0;o<n.length;o++)e^=n.charCodeAt(o),e=Math.imul(e,16777619);return e>>>0}function ge(n){const e=/^\d+$/.test(n)?Number(n):at(n);lt(e)}function lt(n=Math.floor(Math.random()*1e9)){function e(f){return function(){let r=f+=1831565813;return r=Math.imul(r^r>>>15,r|1),r^=r+Math.imul(r^r>>>7,r|61),((r^r>>>14)>>>0)/4294967296}}const o=e(n);Ue=Array.from({length:_},()=>Array.from({length:S},()=>ke()));const u=[],l={x:0,y:0};P(l.x,l.y).visited=!0,u.push(l);const C=[{dx:0,dy:-1,a:"n",b:"s"},{dx:1,dy:0,a:"e",b:"w"},{dx:0,dy:1,a:"s",b:"n"},{dx:-1,dy:0,a:"w",b:"e"}];for(;u.length>0;){const f=u.at(-1);if(!f)break;const r=C.map(M=>({...M,nx:f.x+M.dx,ny:f.y+M.dy})).filter(M=>Ve(M.nx,M.ny)&&!P(M.nx,M.ny).visited);if(r.length===0){u.pop();continue}const m=r[Math.floor(o()*r.length)];if(!m){u.pop();continue}P(f.x,f.y)[m.a]=!1,P(m.nx,m.ny)[m.b]=!1,P(m.nx,m.ny).visited=!0,u.push({x:m.nx,y:m.ny})}for(let f=0;f<_;f++)for(let r=0;r<S;r++)P(r,f).visited=!1;H.value={x:0,y:0},W.value={x:S-1,y:_-1},b.value=!1,T.value=0,z.value=0,L.value=0,Z.value=0,$.value=!1,V.value=0,G.value=0,O.value=0,Y.value=0,K.value=0,D.value=!1,ae.value=0,Q.value=""}function st(n,e){if(!Ve(e.x,e.y))return!1;const o=e.x-n.x,u=e.y-n.y,l=P(n.x,n.y);return o===1?!l.e:o===-1?!l.w:u===1?!l.s:u===-1?!l.n:!1}function it(){L.value++,g("Blocked!","warn",450),navigator.vibrate&&navigator.vibrate(22)}function h(n,e){if(b.value)return;Ee();const o=H.value,u={x:o.x+n,y:o.y+e};if(!st(o,u)){it();return}H.value=u,z.value++,u.x===W.value.x&&u.y===W.value.y&&(b.value=!0,V.value=le.value,G.value=T.value,O.value=z.value,Y.value=L.value,K.value=$e(V.value,G.value,O.value,Y.value),g("Escaped! Submit your score ðŸ†","ok",1200))}function X(){const n=Date.now();n<Z.value||b.value||(Ee(),T.value++,$.value=!0,Z.value=n+hn,window.setTimeout(()=>{$.value=!1},wn))}function xe(){d.value==="random"&&(te.value=Math.floor(Math.random()*1e9)),oe(),ge(x.value),g("Restarted","info",650)}function Ge(){ee.value=!0,E.value?.focus?.()}function Oe(n){if(!ee.value)return;const e=n.key.toLowerCase();if(e===" "||e==="spacebar"||e==="b"){n.preventDefault(),X();return}e==="arrowup"||e==="w"?(n.preventDefault(),h(0,-1)):e==="arrowdown"||e==="s"?(n.preventDefault(),h(0,1)):e==="arrowleft"||e==="a"?(n.preventDefault(),h(-1,0)):(e==="arrowright"||e==="d")&&(n.preventDefault(),h(1,0))}function ut(n){const e=n.target;return!!e?.closest?.(".hud")||!!e?.closest?.(".hudMobile")||!!e?.closest?.(".mobileControls")||!!e?.closest?.(".modalOverlay")}let q=!1,Se=0,_e=0,Ye=0,Pe=!1;function rt(n){if(!ut(n)){Ge();try{n.target.setPointerCapture?.(n.pointerId)}catch{}q=!0,Pe=!1,Se=n.clientX,_e=n.clientY,Ye=Date.now()}}function dt(n){if(!q)return;const e=n.clientX-Se,o=n.clientY-_e;(Math.abs(e)>6||Math.abs(o)>6)&&(Pe=!0)}function vt(n){if(!q)return;q=!1;const e=n.clientX,o=n.clientY,u=Date.now()-Ye,l=e-Se,C=o-_e;if(Math.abs(l)>=Qe||Math.abs(C)>=Qe){Math.abs(l)>Math.abs(C)?h(l>0?1:-1,0):h(0,C>0?1:-1);return}!Pe&&u<=_n&&X()}function ct(){q=!1}function se(){if(!w.value)return;const n=Math.max(1,Math.min(2,window.devicePixelRatio||1)),e=w.value.getBoundingClientRect();w.value.width=Math.floor(e.width*n),w.value.height=Math.floor(e.height*n),a=w.value.getContext("2d"),a&&a.setTransform(n,0,0,n,0,0),tt(e.width,e.height)}function Ke(n,e,o,u,l){a&&(a.save(),a.shadowColor=l,a.shadowBlur=o*1.8,a.fillStyle=u,a.beginPath(),a.arc(n,e,o,0,Math.PI*2),a.fill(),a.restore())}function ft(){if(!a||!w.value)return;const n=w.value.getBoundingClientRect().width,e=w.value.getBoundingClientRect().height;a.clearRect(0,0,n,e);const o=a.createLinearGradient(0,0,0,e);o.addColorStop(0,"#050712"),o.addColorStop(1,"#02030a"),a.fillStyle=o,a.fillRect(0,0,n,e);for(const p of Ie)p.y+=p.s,p.y>e+4&&(p.y=-4,p.x=Math.random()*n),a.globalAlpha=p.a,a.fillStyle="#cfe6ff",a.beginPath(),a.arc(p.x,p.y,p.r,0,Math.PI*2),a.fill();a.globalAlpha=1;const u=18,l=Math.max(12,Math.floor(Math.min((n-u*2)/S,(e-u*2)/_))),C=l*S,f=l*_,r=Math.floor((n-C)/2),m=Math.floor((e-f)/2);if(a.fillStyle="rgba(255,255,255,0.03)",a.fillRect(r-10,m-10,C+20,f+20),$.value){a.save(),a.strokeStyle="rgba(160, 210, 255, 0.95)",a.lineWidth=2.2,a.shadowColor="rgba(120, 200, 255, 0.75)",a.shadowBlur=10;for(let p=0;p<_;p++)for(let re=0;re<S;re++){const de=P(re,p),j=r+re*l,J=m+p*l,ve=j+l,ce=J+l;a.beginPath(),de.n&&(a.moveTo(j,J),a.lineTo(ve,J)),de.e&&(a.moveTo(ve,J),a.lineTo(ve,ce)),de.s&&(a.moveTo(j,ce),a.lineTo(ve,ce)),de.w&&(a.moveTo(j,J),a.lineTo(j,ce)),a.stroke()}a.restore()}const M=r+W.value.x*l+l/2,pt=m+W.value.y*l+l/2;Ke(M,pt,Math.max(7,l*.22),"rgba(90,255,160,0.9)","rgba(90,255,160,0.8)");const yt=r+H.value.x*l+l/2,bt=m+H.value.y*l+l/2;Ke(yt,bt,Math.max(8,l*.26),"rgba(255,230,120,0.95)","rgba(255,220,140,0.85)");const Te=a.createRadialGradient(n/2,e/2,Math.min(n,e)*.25,n/2,e/2,Math.min(n,e)*.75);Te.addColorStop(0,"rgba(0,0,0,0)"),Te.addColorStop(1,"rgba(0,0,0,0.65)"),a.fillStyle=Te,a.fillRect(0,0,n,e)}function He(){ft(),Re=requestAnimationFrame(He)}const ie=s([]),Ce=s(!1),ue=s(!1),Q=s("");async function We(){Ce.value=!0;try{const n=await $fetch("/api/leaderboard",{query:{mode:d.value,seed:x.value,limit:20}});ie.value=n.ok&&n.rows?n.rows:[]}catch{ie.value=[]}finally{Ce.value=!1}}async function mt(){if(b.value){ue.value=!0,Q.value="";try{const n={mode:d.value,seed:x.value,name:U.value||"Guest",timeMs:V.value,blinks:G.value,moves:O.value,invalidMoves:Y.value},e=await $fetch("/api/submit",{method:"POST",body:n});e.ok?(g("Submitted!","ok",900),typeof e.score=="number"&&(K.value=e.score),typeof e.rank=="number"&&(Q.value=`ðŸ† You placed #${e.rank}`),await We()):g(`Submit failed: ${e.error??"unknown"}`,"warn",1200)}catch{g("Submit failed (network/server).","warn",1200)}finally{ue.value=!1}}}async function Xe(){oe();const n=new URL(window.location.href).toString();try{await navigator.clipboard.writeText(n),g("Link copied!","ok",900)}catch{g("Copy failed. Use address bar.","warn",1200)}}wt(d,async()=>{d.value==="random"&&(te.value=Math.floor(Math.random()*1e9)),oe(),ge(x.value),g(`Mode: ${ne.value}`,"info",700)});let Be=null;return ht(()=>{R.value=window.matchMedia?.("(pointer: coarse)").matches||"ontouchstart"in window,R.value&&(ee.value=!0),ot(),oe(),ge(x.value),se(),requestAnimationFrame(()=>se()),requestAnimationFrame(()=>se()),He(),window.addEventListener("keydown",Oe,{passive:!1}),Be=new ResizeObserver(()=>se()),E.value&&Be.observe(E.value),Me=window.setInterval(()=>{he.value=Date.now()},100)}),Mt(()=>{cancelAnimationFrame(Re),window.removeEventListener("keydown",Oe),Me&&window.clearInterval(Me),Be?.disconnect(),F&&window.clearTimeout(F)}),(n,e)=>(c(),v("div",{ref_key:"root",ref:E,class:"root",tabindex:"0",onPointerdown:rt,onPointerup:vt,onPointercancel:ct,onPointermove:dt},[t("canvas",{ref_key:"canvas",ref:w,class:"canvas"},null,512),R.value?(c(),v("div",{key:0,class:fe(["hudMobile",{peek:Fe.value}]),onPointerdown:e[0]||(e[0]=y(()=>{},["stop"])),onPointerup:e[1]||(e[1]=y(()=>{},["stop"])),onPointermove:e[2]||(e[2]=y(()=>{},["stop"])),onPointercancel:e[3]||(e[3]=y(()=>{},["stop"]))},[t("div",St,[e[24]||(e[24]=t("div",{class:"mTitle"},"Blink Maze",-1)),t("div",_t,[t("span",Pt,i(ne.value),1),t("span",Ct,i(x.value),1)])]),t("div",Bt,[t("button",{class:"mBtn2 primary",disabled:B.value>0||b.value,onClick:X},[e[25]||(e[25]=Le(" Blink ",-1)),t("span",Lt,i(B.value>0?`${(B.value/1e3).toFixed(1)}s`:"ready"),1)],8,Tt),t("button",{class:"mBtn2",onClick:xe},"â†»"),t("button",{class:"mBtn2",onClick:Ae},"ðŸ†"),t("button",{class:"mBtn2",onClick:Xe},"â¤´"),t("button",{class:"mBtn2",onClick:et},"âš™")]),t("div",Rt,[t("span",At,"â± "+i((le.value/1e3).toFixed(0))+"s",1),t("span",Dt,"â­ "+i(ze.value),1),t("span",It,"âš¡ "+i(T.value),1),t("span",Nt,"âŒ "+i(L.value),1)]),A.value?(c(),v("div",{key:0,class:fe(["toast",we.value])},i(A.value),3)):k("",!0)],34)):(c(),v("div",{key:1,class:"hud",onPointerdown:e[7]||(e[7]=y(()=>{},["stop"])),onPointerup:e[8]||(e[8]=y(()=>{},["stop"])),onPointermove:e[9]||(e[9]=y(()=>{},["stop"])),onPointercancel:e[10]||(e[10]=y(()=>{},["stop"]))},[t("div",Et,[e[26]||(e[26]=t("div",{class:"title"},"Blink Maze",-1)),t("div",$t,i(ne.value)+" â€¢ "+i(x.value),1)]),e[37]||(e[37]=t("div",{class:"hint"},"Desktop: WASD / Arrow â€¢ Blink: Space",-1)),t("div",zt,[t("button",{class:"btn primary",disabled:B.value>0||b.value,onClick:X},[e[27]||(e[27]=Le(" Blink ",-1)),t("span",Ut,i(B.value>0?`${(B.value/1e3).toFixed(1)}s`:"ready"),1)],8,Ft),t("button",{class:"btn",onClick:xe},"Restart"),t("button",{class:"btn",onClick:Xe},"Share"),t("button",{class:"btn",onClick:Ae},"Leaderboard")]),t("div",Vt,[t("label",Gt,[N(t("input",{type:"radio",value:"daily","onUpdate:modelValue":e[4]||(e[4]=o=>d.value=o)},null,512),[[me,d.value]]),e[28]||(e[28]=t("span",null,"Daily",-1))]),t("label",Ot,[N(t("input",{type:"radio",value:"random","onUpdate:modelValue":e[5]||(e[5]=o=>d.value=o)},null,512),[[me,d.value]]),e[29]||(e[29]=t("span",null,"Random",-1))]),N(t("input",{class:"name","onUpdate:modelValue":e[6]||(e[6]=o=>U.value=o),maxlength:"18",placeholder:"Name"},null,512),[[qe,U.value]])]),t("div",Yt,[t("div",Kt,[e[30]||(e[30]=t("span",null,"Time",-1)),t("b",null,i((le.value/1e3).toFixed(0))+"s",1)]),t("div",Ht,[e[31]||(e[31]=t("span",null,"Blinks",-1)),t("b",null,i(T.value),1)]),t("div",Wt,[e[32]||(e[32]=t("span",null,"Moves",-1)),t("b",null,i(z.value),1)]),t("div",Xt,[e[33]||(e[33]=t("span",null,"Invalid",-1)),t("b",null,i(L.value),1)]),t("div",qt,[e[34]||(e[34]=t("span",null,"Score",-1)),t("b",null,i(ze.value),1)])]),A.value?(c(),v("div",{key:0,class:fe(["toast",we.value])},i(A.value),3)):k("",!0),!D.value&&!b.value?(c(),v("div",Qt,"Move or Blink to start")):k("",!0),b.value?(c(),v("div",jt,[e[36]||(e[36]=t("div",{class:"winTitle"},"âœ… Escaped!",-1)),t("div",Jt,[t("span",null,[t("b",null,i(K.value),1),e[35]||(e[35]=Le(" pts",-1))]),t("span",null,i((V.value/1e3).toFixed(1))+"s",1),t("span",null,i(G.value)+" blinks",1),t("span",null,i(O.value)+" moves",1),t("span",null,i(Y.value)+" invalid",1)]),t("div",Zt,[t("button",{class:"btn primary",disabled:ue.value,onClick:mt},i(ue.value?"Submitting...":"Submit"),9,en),t("button",{class:"btn",onClick:xe},"Play Again")]),Q.value?(c(),v("div",tn,i(Q.value),1)):k("",!0)])):k("",!0)],32)),R.value?(c(),v("div",{key:2,class:fe(["mobileControls",{peek:Fe.value}]),onPointerdown:e[15]||(e[15]=y(()=>{},["stop"])),onPointerup:e[16]||(e[16]=y(()=>{},["stop"])),onPointermove:e[17]||(e[17]=y(()=>{},["stop"])),onPointercancel:e[18]||(e[18]=y(()=>{},["stop"]))},[t("button",{class:"mBtn",onClick:e[11]||(e[11]=o=>h(0,-1))},"â–²"),t("div",nn,[t("button",{class:"mBtn",onClick:e[12]||(e[12]=o=>h(-1,0))},"â—€"),t("button",{class:"mBtn blink",disabled:B.value>0||b.value,onClick:X},"BLINK",8,on),t("button",{class:"mBtn",onClick:e[13]||(e[13]=o=>h(1,0))},"â–¶")]),t("button",{class:"mBtn",onClick:e[14]||(e[14]=o=>h(0,1))},"â–¼")],34)):k("",!0),pe.value?(c(),v("div",{key:3,class:"modalOverlay",onPointerdown:De},[t("div",{class:"modal",onPointerdown:e[19]||(e[19]=y(()=>{},["stop"]))},[t("div",an,[t("div",null,[e[38]||(e[38]=t("div",{class:"modalTitle"},"ðŸ† Leaderboard",-1)),t("div",ln,i(ne.value)+" â€¢ Seed: "+i(x.value),1)]),t("button",{class:"xBtn",onClick:De},"âœ•")]),Ce.value?(c(),v("div",sn,"Loadingâ€¦")):(c(),v("ol",un,[(c(!0),v(kt,null,gt(ie.value,(o,u)=>(c(),v("li",{key:u,class:"lbRow"},[t("span",rn,"#"+i(u+1),1),t("span",dn,i(o.name),1),t("span",vn,i(o.score),1),t("span",cn,i((o.time_ms/1e3).toFixed(1))+"s",1)]))),128)),ie.value.length===0?(c(),v("li",fn,"No scores yet. Be the first!")):k("",!0)]))],32)],32)):k("",!0),ye.value?(c(),v("div",{key:4,class:"modalOverlay",onPointerdown:be},[t("div",{class:"modal",onPointerdown:e[23]||(e[23]=y(()=>{},["stop"]))},[t("div",{class:"modalHead"},[e[39]||(e[39]=t("div",null,[t("div",{class:"modalTitle"},"âš™ Settings"),t("div",{class:"modalSub"},"Mode + name")],-1)),t("button",{class:"xBtn",onClick:be},"âœ•")]),t("div",mn,[t("div",pn,[t("label",yn,[N(t("input",{type:"radio",value:"daily","onUpdate:modelValue":e[20]||(e[20]=o=>d.value=o)},null,512),[[me,d.value]]),e[40]||(e[40]=t("span",null,"Daily",-1))]),t("label",bn,[N(t("input",{type:"radio",value:"random","onUpdate:modelValue":e[21]||(e[21]=o=>d.value=o)},null,512),[[me,d.value]]),e[41]||(e[41]=t("span",null,"Random",-1))])]),N(t("input",{class:"name wide","onUpdate:modelValue":e[22]||(e[22]=o=>U.value=o),maxlength:"18",placeholder:"Name"},null,512),[[qe,U.value]]),t("button",{class:"btn primary wide",onClick:be},"Done")])],32)],32)):k("",!0),!ee.value&&!R.value?(c(),v("div",{key:5,class:"focusOverlay",onPointerdown:Ge}," Click / tap to focus (keyboard) ",32)):k("",!0)],544))}}),Cn=Object.assign(Je(Pn,[["__scopeId","data-v-2ac071ef"]]),{__name:"BlinkMazeGame"}),Bn={class:"page"},Tn=je({__name:"index",setup(Ze){return(E,w)=>(c(),v("div",Bn,[xt(Cn)]))}}),Rn=Je(Tn,[["__scopeId","data-v-8acfc849"]]);export{Rn as default};
